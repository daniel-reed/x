{"version":3,"file":"main.browser.js","sources":["../src/main.js"],"sourcesContent":["export default class x {\r\n    static text(url, options) {\r\n        let request = new Request();\r\n        let opts = {type: \"POST\", url: url};\r\n        Object.assign(opts, options);\r\n        request.open(opts);\r\n\r\n        x.setTextHeaders(request, opts);\r\n        x.setHeaders(request, opts);\r\n        x.setFunctionOverrides(request, opts);\r\n\r\n        let data = opts.hasOwnProperty('data') ? opts.data : undefined;\r\n        request.send(data);\r\n\r\n        return x.returnRequestOrPromise(request, options);\r\n    }\r\n\r\n    static json(url, options) {\r\n        let request = new Request();\r\n        let opts = {type: \"POST\", url: url, responseType: \"json\"};\r\n        Object.assign(opts, options);\r\n        request.open(opts);\r\n\r\n        x.setJSONHeaders(request, opts);\r\n        x.setHeaders(request, opts);\r\n        x.setFunctionOverrides(request, opts);\r\n\r\n        let data = opts.hasOwnProperty('data') ? JSON.stringify(opts.data) : undefined;\r\n        request.send(data);\r\n\r\n        return x.returnRequestOrPromise(request, options);\r\n    }\r\n\r\n    static proto(url, options) {\r\n        let request = new Request();\r\n        let opts = {type: \"POST\", url: url, responseType: \"json\"};\r\n        Object.assign(opts, options);\r\n        request.open(opts);\r\n\r\n        x.setProtoHeaders(request, opts);\r\n        x.setHeaders(request, opts);\r\n        x.setFunctionOverrides(request, opts);\r\n        x.setProtoConvert(request, opts);\r\n\r\n        let data;\r\n        if (opts.hasOwnProperty('data') && opts.data.hasOwnProperty('serializeBinary')) {\r\n            data = opts.data.serializeBinary();\r\n        }\r\n        request.send(data);\r\n\r\n        return x.returnRequestOrPromise(request, options);\r\n    }\r\n\r\n    static setJSONHeaders(request, options) {\r\n        x.setXRequestedWithHeader(request, options);\r\n        request.setHeader(\"Content-Type\", \"application/json\");\r\n    }\r\n\r\n    static setTextHeaders(request, options) {\r\n        x.setXRequestedWithHeader(request, options);\r\n        request.setHeader(\"Content-Type\", \"text/plain\");\r\n    }\r\n\r\n    static setProtoHeaders(request, options) {\r\n        x.setXRequestedWithHeader(request, options);\r\n        request.setHeader(\"Content-Type\", \"application/octet-stream\")\r\n    }\r\n\r\n    static setXRequestedWithHeader(request, options) {\r\n        if (!options.hasOwnProperty('requestedWith') || options.requestedWith) {\r\n            request.setHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n        }\r\n    }\r\n\r\n    static setHeaders(request, options) {\r\n        if (options.hasOwnProperty('headers')) return;\r\n\r\n        for (let key in options.headers) {\r\n            if (!options.headers.hasOwnProperty(key)) continue;\r\n            request.setHeader(key, options.headers[key]);\r\n        }\r\n    }\r\n\r\n    static setFunctionOverrides(request, options) {\r\n        if (options.hasOwnProperty('convert')) request.convert = options.convert;\r\n        if (options.hasOwnProperty('success')) request.success = options.success;\r\n        if (options.hasOwnProperty('error')) request.error = options.error;\r\n        if (options.hasOwnProperty('aborted')) request.aborted = options.aborted;\r\n        if (options.hasOwnProperty('timeout')) request.timeout = options.timeout;\r\n    }\r\n\r\n    static setProtoConvert(request, options) {\r\n        if (!options.hasOwnProperty('proto')) return;\r\n        request.convert = x.buildProtoConvert(options.proto);\r\n    }\r\n\r\n    static isPending(request) {\r\n        if (request === null) return false;\r\n        if (request === undefined) return false;\r\n        if (!request.hasOwnProperty('isPending')) return false;\r\n        return request.isPending();\r\n    }\r\n\r\n    static abort(request) {\r\n        if (request === null) return;\r\n        if (request === undefined) return;\r\n        if (!request.hasOwnProperty('abort')) return;\r\n        return request.abort();\r\n    }\r\n\r\n    static buildProtoConvert(proto) {\r\n        return function (data, _this) {\r\n            return proto.deserializeBinary(data);\r\n        }\r\n    }\r\n\r\n    static returnRequestOrPromise(request, options) {\r\n        switch (options.returnType) {\r\n            case \"promise\": return request.getPromise();\r\n            default: return request;\r\n        }\r\n    }\r\n}\r\n\r\nclass Request {\r\n    constructor() {\r\n        this.xhr = new XMLHttpRequest();\r\n        this.promise = new Promise((resolve, reject) => {\r\n            this.resolve = resolve;\r\n            this.reject = reject;\r\n        });\r\n    }\r\n\r\n    open = (opts) => {\r\n        if (!opts.hasOwnProperty('url')) throw \"Missing 'url' Parameter\";\r\n\r\n        let type = opts.hasOwnProperty(\"type\") ? opts.type : \"GET\";\r\n\r\n        this.xhr.open(type, opts.url);\r\n\r\n        if (opts.hasOwnProperty(\"responseType\")) this.xhr.responseType = opts.responseType;\r\n        this.xhr.onreadystatechange = this.__handleReadyStateChange;\r\n        if (opts.hasOwnProperty(\"timeout\")) {\r\n            this.xhr.timeout = opts.timeout;\r\n            this.xhr.ontimeout = this.__handleTimeout();\r\n        }\r\n    }\r\n\r\n    isPending = () => {\r\n        switch (this.xhr.readyState) {\r\n            case 0: case 4: return false;\r\n            default: return true;\r\n        }\r\n    }\r\n\r\n    setHeader = (k, v) => {\r\n        this.xhr.setRequestHeader(k, v);\r\n    }\r\n\r\n    getPromise = () => {\r\n        return this.promise;\r\n    }\r\n\r\n    send = (data) => {\r\n        if (data === undefined) return this.xhr.send();\r\n        return this.xhr.send(data);\r\n    }\r\n\r\n    abort = () => {\r\n        if (this.xhr.readyState === 4 || this.xhr.readyState === 0) return;\r\n        return this.xhr.abort();\r\n    }\r\n\r\n    __handleReadyStateChange = () => {\r\n        switch (this.xhr.readyState) {\r\n            case XMLHttpRequest.DONE: return this.__handleDone();\r\n        }\r\n    }\r\n\r\n    __handleDone = () => {\r\n        if (this.xhr.status === 200) return this.__handleSuccess();\r\n        if (this.xhr.status === 0) return this.__handleAborted();\r\n        return this.__handleError();\r\n    }\r\n\r\n    __handleSuccess = () => {\r\n        switch (this.xhr.responseType) {\r\n            case \"json\":\r\n                this.success(this.convert(this.xhr.response), this);\r\n                break;\r\n            default:\r\n                this.success(this.convert(this.xhr.responseText), this);\r\n                break;\r\n        }\r\n    }\r\n\r\n    __handleError = () => {\r\n        this.error(this.xhr.response, this, this.xhr.status)\r\n    }\r\n\r\n    __handleAborted = () => {\r\n        this.aborted(this);\r\n    }\r\n\r\n    __handleTimeout = () => {\r\n        this.timeout(this);\r\n    }\r\n\r\n    convert = function (data, _this) {return data;}\r\n\r\n    success = function (response, _this) {\r\n        _this.resolve(_this);\r\n    }\r\n\r\n    error = function (response, _this , status) {\r\n        _this.reject(_this);\r\n    }\r\n\r\n    aborted = function (_this) {\r\n        _this.reject(_this);\r\n    }\r\n\r\n    timeout = function (_this) {\r\n        _this.reject(_this);\r\n    }\r\n}\r\n\r\n"],"names":["x","url","options","request","Request","opts","type","assign","open","setTextHeaders","setHeaders","setFunctionOverrides","data","hasOwnProperty","undefined","send","returnRequestOrPromise","responseType","setJSONHeaders","JSON","stringify","setProtoHeaders","setProtoConvert","serializeBinary","setXRequestedWithHeader","setHeader","requestedWith","key","headers","convert","success","error","aborted","timeout","buildProtoConvert","proto","isPending","abort","_this","deserializeBinary","returnType","getPromise","xhr","onreadystatechange","__handleReadyStateChange","ontimeout","__handleTimeout","readyState","k","v","setRequestHeader","promise","XMLHttpRequest","DONE","__handleDone","status","__handleSuccess","__handleAborted","__handleError","response","responseText","resolve","reject","Promise"],"mappings":"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"}